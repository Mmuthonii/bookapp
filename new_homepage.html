<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OneMoreChapter - Homepage</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #e5e1da;
        color: #4a4a3d;
      }

      header {
        background-color: #9cab85;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        position: relative;
      }

      header .logo {
        font-size: 1.5rem; /* Slightly larger for better readability */
        font-style: italic;
        color: #4a4a3d;
        font-weight: bold;
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
      }

      nav a {
        text-decoration: none;
        color: #ffffff;
        font-size: 1.1rem;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 5px;
        transition: background-color 0.3s ease;
      }

      nav a:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .icon-bar {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .icon {
        width: 24px; /* Adjust the size if needed */
        height: 24px;
        cursor: pointer;
        fill: white; /* Ensures the icon color matches your navbar */
        transition: opacity 0.3s ease;
      }

      .icon:hover {
        opacity: 0.7;
      }

      .icons {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .icons .icon {
        cursor: pointer;
        font-size: 1.5rem;
        color: #ffffff;
        position: relative;
      }

      .search-popup {
        display: none;
        position: absolute;
        top: 50px; /* Adjusted positioning */
        right: 20px; /* Aligns with search icon */
        background-color: #ffffff;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 1000; /* Ensures it appears above other elements */
      }

      .search-popup input {
        padding: 8px;
        font-size: 1rem;
        width: 200px;
        border: 1px solid #ddd;
        border-radius: 4px;
        outline: none;
      }

      .dropdown {
        display: none;
        position: absolute;
        top: 50px;
        right: 60px;
        background-color: #ffffff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
      }

      .dropdown a {
        display: block;
        padding: 10px;
        text-decoration: none;
        color: #4a4a3d;
      }

      .dropdown a:hover {
        background-color: #f0f0f0;
      }

      .language {
        cursor: pointer;
        font-size: 1rem;
        color: #ffffff;
      }

      .container {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .shelves-and-search {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 20px;
        width: 100%;
        max-width: 1200px;
        margin-bottom: 30px;
      }

      .shelves {
        flex: 1;
      }

      .shelves img {
        width: 100%;
        max-width: 400px;
        height: auto;
      }

      .search-bar {
        display: flex;
        align-items: center;
        background-color: #ffffff;
        border: 0px solid #ccc;
        border-radius: 60px; /* Smooth rounded corners */
        padding: 10px;
        box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        width: 100%;
        max-width: 800px; /* Ensures it doesn't stretch too much */
        margin: 0px auto; /* Centers the search bar on the page */
      }

      .search-bar input {
        flex: 1;
        border-radius: 60px;
        width: 82%; /* Adjust the input's width */
        padding: 10px 20px; /* Inner spacing */
        border: 0px;
        outline: 0px;
        font-size: 1rem;

        background-color: #f9f9f9; /* Slightly off-white background */
      }

      .search-bar button {
        padding: 10px 20px; /* Space around the text */
        border: none;
        background-color: #9cab85;
        color: white;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); /* Matches container shadow */
        transition: background-color 0.3s ease; /* Smooth hover transition */
        margin-left: 10px; /* Adds space between the input and button */
      }

      .search-bar button:hover {
        background-color: #86a374; /* Slightly darker green for hover effect */
      }

      .recommended {
        width: 100%;
        max-width: 1200px;
        background-color: #c3c6a8;
        padding: 40px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
      }

      .recommended h2 {
        font-size: 2rem;
        margin-bottom: 20px;
      }

      .recommended-reads {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 20px;
        justify-content: center;
      }

      .book-placeholder {
        width: 100%;
        padding-bottom: 10%; /* Adjusted aspect ratio for shorter tabs */
        background-color: #e0e0d1;
        border-radius: 10px;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 15px; /* Adds space between the book cover and top of the card */
      }

      .book-placeholder img {
        width: 80%;
        height: auto;
        object-fit: cover;
        margin-bottom: 10px; /* Adds space between the book cover and details */
        border-radius: 5px;
      }

      .book-details {
        text-align: center;
        padding-top: 5px; /* Optional extra space for cleaner alignment */
      }

      .book-details p {
        margin: 5px 0;
        font-size: 0.9rem;
      }

      .book-details p strong {
        font-size: 1rem;
      }
      footer {
        margin-top: 30px;
        text-align: center;
        font-size: 0.9rem;
        color: #7a7a7a;
      }
      nav a:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .dropdown-content {
        position: absolute;
        background-color: #f9f9f9;
        min-width: 250px;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 5px;
        display: none;
      }

      .dropdown-content p {
        padding: 10px;
        margin: 0;
        cursor: pointer;
      }

      .dropdown-content p:hover {
        background-color: #ddd;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">OneMoreChapter</div>
      <nav>
        <ul>
          <li><a href="new_homepage.html">Home</a></li>
          <li><a href="new_bookonloan.html">Books on Loan</a></li>
          <li><a href="new_inventory.html">My Inventory</a></li>
          <li><a href="new_currentlyreading.html">Currently Reading</a></li>
          <li><a href="new_requests.html">Requests</a></li>
        </ul>
      </nav>
      <div class="icons">
        <!-- Search Icon -->
        <svg
          class="icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          onclick="toggleSearchPopup(event)"
        >
          <path
            d="M10 2a8 8 0 015.293 13.707l4 4a1 1 0 01-1.414 1.414l-4-4A8 8 0 1110 2zm0 2a6 6 0 100 12 6 6 0 000-12z"
          ></path>
        </svg>

        <!-- Messaging Icon -->
        <svg
          class="icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          onclick="window.location.href='new_messages.html'"
        >
          <path
            d="M20 2H4a2 2 0 00-2 2v12a2 2 0 002 2h4l4 4v-4h8a2 2 0 002-2V4a2 2 0 00-2-2zm0 12H10v2.586L8.414 14H4V4h16v10z"
          ></path>
        </svg>

        <!-- Profile Icon -->
        <svg
          class="icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          onclick="toggleDropdown()"
        >
          <path
            d="M12 12a5 5 0 100-10 5 5 0 000 10zm0 2c-4.418 0-8 2.015-8 4.5V21h16v-2.5c0-2.485-3.582-4.5-8-4.5z"
          ></path>
        </svg>

        <div class="dropdown" id="dropdownMenu">
          <a href="new_profile.html">My Profile</a>
          <a href="new_settings.html">My Profile</a>
          <a href="#" onclick="logout()">Log Out</a>
        </div>
      </div>
      <div class="search-popup" id="searchPopup">
        <input
          type="text"
          id="navSearchInput"
          placeholder="Search for books..."
          onkeydown="handleSearch(event)"
        />
        <button onclick="searchBooksFromNav()">Search</button>
      </div>
      <!-- Search Box -->
      <div class="search-popup" id="searchPopup">
        <input
          type="text"
          id="navSearchInput"
          placeholder="Search..."
          onkeydown="handleSearch(event)"
        />
      </div>
    </header>

    <div class="container">
      <!-- Shelves and Search Bar Section -->
      <div class="shelves-and-search">
        <div class="shelves">
          <img src="pictures/bookshelf.png" alt="Bookshelf" />
        </div>
        <div class="search-bar">
          <div class="search-bar">
            <input
              type="text"
              class="search-input"
              placeholder="Search for books..."
            />
            <button class="search-button">Search</button>
          </div>
        </div>

        <div id="searchResults" class="search-results"></div>
      </div>

      <!-- Recommended Reads Section -->
      <div class="recommended">
        <h2>Recommended Reads:</h2>
        <div class="recommended-reads" id="recommendedReads">
          <!-- Books will be populated here -->
        </div>
      </div>
    </div>

    <footer>
      <p>Terms and Conditions | Privacy | Help</p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Load recommended books on page load
        fetchRecommendedBooks();
      });
      // Function to handle Enter key press in search input
      function handleSearch(event) {
        if (event.key === "Enter") {
          searchBooksFromNav();
        }
      }

      // Function to execute book search from the navigation bar
      function searchBooksFromNav() {
        const query = document.getElementById("navSearchInput").value.trim();
        if (!query) {
          alert("Please enter a search query!");
          return;
        }
        window.location.href = `search-results.html?query=${encodeURIComponent(
          query
        )}`;
      }
      // Function to toggle the search popup visibility
      function toggleSearchPopup(event) {
        event.stopPropagation(); // Prevents the event from closing immediately

        const popup = document.getElementById("searchPopup");

        // Toggle display
        if (popup.style.display === "block") {
          popup.style.display = "none";
        } else {
          popup.style.display = "block";
        }
      }

      // Ensure clicking outside closes the search popup
      document.addEventListener("click", (event) => {
        const popup = document.getElementById("searchPopup");
        const searchIcon = document.querySelector(".search-icon");

        if (
          popup.style.display === "block" &&
          !popup.contains(event.target) &&
          !searchIcon.contains(event.target)
        ) {
          popup.style.display = "none";
        }
      });

      // Fetch recommended books based on genres
      async function fetchRecommendedBooks() {
        const genres = JSON.parse(sessionStorage.getItem("selectedGenres")) || [
          "Fiction",
          "Mystery",
          "Fantasy",
          "Romance",
          "Horror",
        ];
        const recommendedReads = document.getElementById("recommendedReads");
        recommendedReads.innerHTML = ""; // Clear any previous content

        for (const genre of genres) {
          try {
            const randomStartIndex = Math.floor(Math.random() * 20); // Randomize start index for variety
            const response = await fetch(
              `https://www.googleapis.com/books/v1/volumes?q=subject:${encodeURIComponent(
                genre
              )}&startIndex=${randomStartIndex}&maxResults=1`
            );
            const data = await response.json();

            if (data.items) {
              data.items.forEach((book) => {
                const bookDiv = document.createElement("div");
                bookDiv.classList.add("book-placeholder");

                bookDiv.innerHTML = `
                        <img src="${
                          book.volumeInfo.imageLinks?.thumbnail ||
                          "https://via.placeholder.com/100x150"
                        }" alt="${book.volumeInfo.title}" />
                        <div class="book-details">
                            <p><strong>${
                              book.volumeInfo.title || "Unknown Title"
                            }</strong></p>
                            <p>${
                              book.volumeInfo.authors?.join(", ") ||
                              "Unknown Author"
                            }</p>
                        </div>
                    `;
                recommendedReads.appendChild(bookDiv);
              });
            }
          } catch (error) {
            console.error(`Error fetching books for genre: ${genre}`, error);
          }
        }
      }

      // Redirect to profile page
      function redirectToProfile() {
        window.location.href = "profile.html";
      }

      // Logout function to clear session and redirect
      function logout() {
        sessionStorage.clear();
        localStorage.clear();
        alert("You have been logged out.");
        window.location.href = "index.html";
      }

      async function searchBooks() {
        const searchInput = document.querySelector(".search-input");
        const query = searchInput.value.trim();

        if (!query) {
          alert("Please enter a search query!");
          return;
        }

        // Redirect to search results page with query as a parameter
        window.location.href = `search-results.html?query=${encodeURIComponent(
          query
        )}`;
      }

      // Ensure search button executes `searchBooks()` on click
      document.addEventListener("DOMContentLoaded", () => {
        const searchButton = document.querySelector(".search-button");
        if (searchButton) {
          searchButton.addEventListener("click", (event) => {
            event.preventDefault(); // Prevents default form submission
            searchBooks();
          });
        }
      });

      // Display search results
      async function displaySearchResults() {
        const query = document
          .getElementById("searchBar")
          .value.trim()
          .toLowerCase();
        const searchResults = document.getElementById("searchResults");

        searchResults.innerHTML = ""; // Clear previous results

        if (!query) {
          searchResults.innerHTML = "<p>Please enter a search term</p>";
          return;
        }

        try {
          const response = await fetch(
            `http://localhost:8080/books/search?query=${query}`
          );
          if (!response.ok) throw new Error("Failed to fetch books");

          const books = await response.json();

          if (books.length === 0) {
            searchResults.innerHTML = "<p>No books found</p>";
          } else {
            books.forEach((book) => {
              const bookCard = document.createElement("div");
              bookCard.className = "book-card";
              bookCard.innerHTML = `
                    <img src="${
                      book.image || "https://via.placeholder.com/100"
                    }" alt="${book.title}" class="book-thumbnail">
                    <div class="book-details">
                        <h3>${book.title}</h3>
                        <p>Author: ${book.author || "Unknown"}</p>
                        <p>Genre: ${book.genre || "Unknown"}</p>
                        <button onclick="viewBookDetails(${
                          book.id
                        })">View Details</button>
                    </div>
                `;
              searchResults.appendChild(bookCard);
            });
          }
        } catch (error) {
          console.error("Error fetching books:", error);
        }
      }

      // Redirect to book details page
      function viewBookDetails(bookId) {
        window.location.href = `book-details.html?bookId=${bookId}`;
      }

      // Hide dropdown when clicking outside
      document.addEventListener("click", (event) => {
        const dropdown = document.getElementById("searchDropdown");
        const searchBar = document.getElementById("searchBar");

        if (
          dropdown &&
          !dropdown.contains(event.target) &&
          event.target !== searchBar
        ) {
          dropdown.style.display = "none";
        }
      });
    </script>
  </body>
</html>
